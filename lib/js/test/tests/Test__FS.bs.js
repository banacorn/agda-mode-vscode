// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Assert = require("assert");
var Vscode = require("vscode");
var Nodefs = require("node:fs");
var Nodeos = require("node:os");
var Nodepath = require("node:path");
var FS$AgdaModeVscode = require("../../src/FS.bs.js");

describe.only("FS", (function () {
        this.timeout(10000);
        describe("readDirectory", (function () {
                it("should return directory contents when directory exists", (async function () {
                        var tempDir = Nodepath.join(Nodeos.tmpdir(), "fs-test-" + String(Date.now() | 0));
                        await Nodefs.promises.mkdir(tempDir, {
                              recursive: true,
                              mode: 511
                            });
                        Nodefs.writeFileSync(Nodepath.join(tempDir, "test.txt"), Buffer.from("test"));
                        await Nodefs.promises.mkdir(Nodepath.join(tempDir, "subdir"), {
                              recursive: true,
                              mode: 511
                            });
                        var uri = Vscode.Uri.file(tempDir);
                        var result = await FS$AgdaModeVscode.readDirectory(uri);
                        if (result.TAG === "Ok") {
                          var entries = result._0;
                          var names = entries.map(function (param) {
                                return param[0];
                              });
                          Assert.ok(names.includes("test.txt"));
                          Assert.ok(names.includes("subdir"));
                          var testFileEntry = entries.find(function (param) {
                                return param[0] === "test.txt";
                              });
                          var subdirEntry = entries.find(function (param) {
                                return param[0] === "subdir";
                              });
                          if (testFileEntry !== undefined && subdirEntry !== undefined) {
                            Assert.ok(true);
                          } else {
                            Assert.fail("Expected to find both file and directory entries");
                          }
                        } else {
                          Assert.fail("Expected Ok, got Error: " + result._0);
                        }
                        Nodefs.unlinkSync(Nodepath.join(tempDir, "test.txt"));
                        Nodefs.rmdirSync(Nodepath.join(tempDir, "subdir"));
                        Nodefs.rmdirSync(tempDir);
                      }));
                it("should return Error when directory does not exist", (async function () {
                        var nonExistentPath = Nodepath.join(Nodeos.tmpdir(), "non-existent-" + String(Date.now() | 0));
                        var uri = Vscode.Uri.file(nonExistentPath);
                        var result = await FS$AgdaModeVscode.readDirectory(uri);
                        if (result.TAG === "Ok") {
                          Assert.fail("Expected Error for non-existent directory, got Ok");
                          return ;
                        }
                        Assert.ok(result._0.length > 0);
                      }));
                it("should return Error when path is a file, not directory", (async function () {
                        var tempFile = Nodepath.join(Nodeos.tmpdir(), "fs-test-file-" + String(Date.now() | 0) + ".txt");
                        Nodefs.writeFileSync(tempFile, Buffer.from("test content"));
                        var uri = Vscode.Uri.file(tempFile);
                        var result = await FS$AgdaModeVscode.readDirectory(uri);
                        if (result.TAG === "Ok") {
                          Assert.fail("Expected Error when trying to read file as directory, got Ok");
                        } else {
                          Assert.ok(result._0.length > 0);
                        }
                        Nodefs.unlinkSync(tempFile);
                      }));
              }));
      }));

/*  Not a pure module */
