// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Vscode = require("vscode");
var Nodepath = require("node:path");
var Untildify = require("untildify");
var Caml_option = require("rescript/lib/js/caml_option.js");
var OS$AgdaModeVscode = require("../../Util/OS.bs.js");

function parse(raw) {
  var result;
  try {
    result = Caml_option.some(new URL(raw));
  }
  catch (exn){
    result = undefined;
  }
  var result$1;
  if (result !== undefined) {
    var url = Caml_option.valFromOption(result);
    result$1 = url.protocol === "lsp:" || !(url.protocol === "file:" || !url.protocol.startsWith("vscode")) ? Caml_option.some(url) : undefined;
  } else {
    result$1 = undefined;
  }
  if (result$1 !== undefined) {
    var url$1 = Caml_option.valFromOption(result$1);
    if (url$1.protocol === "lsp:") {
      return {
              TAG: "LspURI",
              _0: raw,
              _1: url$1
            };
    }
    if (url$1.protocol.startsWith("vscode")) {
      return {
              TAG: "FileURI",
              _0: raw,
              _1: Vscode.Uri.parse(raw)
            };
    }
    var path = Untildify(raw);
    var path$1 = Nodepath.normalize(path);
    var path$2 = OS$AgdaModeVscode.onUnix ? path$1 : path$1.replace(/^\\([a-zA-Z])\\/, "$1\:\\");
    var absolutePath = Nodepath.resolve(path$2);
    return {
            TAG: "FileURI",
            _0: raw,
            _1: Vscode.Uri.file(absolutePath)
          };
  }
  var filePath = raw.startsWith("file://") ? Vscode.Uri.parse(raw).fsPath : raw;
  var path$3 = Untildify(filePath);
  var path$4 = Nodepath.normalize(path$3);
  var path$5 = OS$AgdaModeVscode.onUnix ? path$4 : path$4.replace(/^\\([a-zA-Z])\\/, "$1\:\\");
  var absolutePath$1 = Nodepath.resolve(path$5);
  return {
          TAG: "FileURI",
          _0: raw,
          _1: Vscode.Uri.file(absolutePath$1)
        };
}

function toString(uri) {
  return uri._1.toString();
}

function equal(x, y) {
  if (x.TAG === "FileURI") {
    if (y.TAG === "FileURI") {
      return x._1.toString() === y._1.toString();
    } else {
      return false;
    }
  } else if (y.TAG === "FileURI") {
    return false;
  } else {
    return x._1.toString() === y._1.toString();
  }
}

exports.parse = parse;
exports.toString = toString;
exports.equal = equal;
/* vscode Not a pure module */
