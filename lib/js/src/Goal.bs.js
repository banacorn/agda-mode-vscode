// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Vscode = require("vscode");
var Util$AgdaModeVscode = require("./Util/Util.bs.js");
var Common$AgdaModeVscode = require("./View/Common.bs.js");
var Editor$AgdaModeVscode = require("./Editor.bs.js");
var Parser$AgdaModeVscode = require("./Parser/Parser.bs.js");
var SourceFile$AgdaModeVscode = require("./Parser/SourceFile.bs.js");

function generateDiffs($$document, indices) {
  var fileName = Parser$AgdaModeVscode.filepath($$document.fileName);
  var source = Editor$AgdaModeVscode.$$Text.getAll($$document);
  return SourceFile$AgdaModeVscode.parse(indices, fileName, source);
}

function getInnerRange(self, $$document) {
  var interval_0 = self.interval[0] + 2 | 0;
  var interval_1 = self.interval[1] - 2 | 0;
  var interval = [
    interval_0,
    interval_1
  ];
  return Common$AgdaModeVscode.Interval.toVSCodeRange($$document, interval);
}

function getOuterRange(self, $$document) {
  return Common$AgdaModeVscode.Interval.toVSCodeRange($$document, self.interval);
}

function getContent(self, $$document) {
  var innerRange = getInnerRange(self, $$document);
  return Editor$AgdaModeVscode.$$Text.get($$document, innerRange).trim();
}

function setContent(self, $$document, text) {
  var innerRange = getInnerRange(self, $$document);
  return Editor$AgdaModeVscode.$$Text.replace($$document, innerRange, " " + text + " ");
}

function setCursor(self, editor) {
  var $$document = editor.document;
  var match = self.interval;
  var position = $$document.positionAt(match[0] + 3 | 0);
  Editor$AgdaModeVscode.Cursor.set(editor, position);
  var range = Common$AgdaModeVscode.Interval.toVSCodeRange($$document, self.interval);
  editor.revealRange(range, undefined);
}

function buildHaskellRange(self, $$document, version, filepath) {
  var match = self.interval;
  var end_ = match[1];
  var start = match[0];
  var startPoint = $$document.positionAt(start);
  var endPoint = $$document.positionAt(end_);
  var startIndex = String(start + 3 | 0);
  var startRow = String(startPoint.line + 1 | 0);
  var startColumn = String(startPoint.character + 3 | 0);
  var startPart = startIndex + " " + startRow + " " + startColumn;
  var endIndex$p = String(end_ - 3 | 0);
  var endRow = String(endPoint.line + 1 | 0);
  var endColumn = String(endPoint.character - 1 | 0);
  var endPart = endIndex$p + " " + endRow + " " + endColumn;
  if (Util$AgdaModeVscode.Version.gte(version, "2.8.0")) {
    return "(intervalsToRange (Just (mkAbsolute \"" + filepath + "\")) [Interval () (Pn () " + startPart + ") (Pn () " + endPart + ")])";
  } else if (Util$AgdaModeVscode.Version.gte(version, "2.5.1")) {
    return "(intervalsToRange (Just (mkAbsolute \"" + filepath + "\")) [Interval (Pn () " + startPart + ") (Pn () " + endPart + ")])";
  } else {
    return "(Range [Interval (Pn (Just (mkAbsolute \"" + filepath + "\")) " + startPart + ") (Pn (Just (mkAbsolute \"" + filepath + "\")) " + endPart + ")])";
  }
}

function refreshDecoration(self, editor) {
  var range = getOuterRange(self, editor.document);
  Editor$AgdaModeVscode.Decoration.decorate(editor, self.decorationBackground, [range]);
  var range$1 = new Vscode.Range(range.start, range.end.translate(0, -2));
  Editor$AgdaModeVscode.Decoration.decorate(editor, self.decorationIndex, [range$1]);
}

function destroyDecoration(self) {
  Editor$AgdaModeVscode.Decoration.destroy(self.decorationBackground);
  Editor$AgdaModeVscode.Decoration.destroy(self.decorationIndex);
}

var Module = {
  buildHaskellRange: buildHaskellRange,
  generateDiffs: generateDiffs,
  getContent: getContent,
  setContent: setContent,
  setCursor: setCursor,
  refreshDecoration: refreshDecoration,
  destroyDecoration: destroyDecoration
};

exports.Module = Module;
exports.buildHaskellRange = buildHaskellRange;
exports.generateDiffs = generateDiffs;
exports.getContent = getContent;
exports.setContent = setContent;
exports.setCursor = setCursor;
exports.refreshDecoration = refreshDecoration;
exports.destroyDecoration = destroyDecoration;
/* vscode Not a pure module */
