// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var Path = require("path");
var Curry = require("bs-platform/lib/js/curry.js");
var Vscode = require("vscode");
var Js_math = require("bs-platform/lib/js/js_math.js");
var Vscode$AgdaModeVscode = require("./Vscode.bs.js");

function html(distPath, styleUri, scriptUri) {
  var text = "";
  var charaterSet = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
  var cardinality = charaterSet.length;
  for(var _for = 0; _for <= 32; ++_for){
    text = text + charaterSet.charAt(Js_math.floor(Math.random() * cardinality));
  }
  var nonce = text;
  var styleUri$1 = Vscode.Uri.file(Path.join(distPath, styleUri)).with(Vscode$AgdaModeVscode.Uri.makeChange(undefined, undefined, undefined, undefined, "vscode-resource", /* () */0));
  var scriptUri$1 = Vscode.Uri.file(Path.join(distPath, scriptUri)).with(Vscode$AgdaModeVscode.Uri.makeChange(undefined, undefined, undefined, undefined, "vscode-resource", /* () */0));
  var metaContent = "default-src 'none'; img-src vscode-resource: https:; script-src 'nonce-" + (nonce + "';style-src vscode-resource: 'unsafe-inline' http: https: data:;");
  return "\n<!DOCTYPE html>\n			<html lang=\"en\">\n			<head>\n				<meta charset=\"utf-8\">\n				<meta name=\"viewport\" content=\"width=device-width,initial-scale=1,shrink-to-fit=no\">\n				<meta name=\"theme-color\" content=\"#000000\">\n				<title>React App</title>\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"" + (String(styleUri$1) + ("\">\n				<meta http-equiv=\"Content-Security-Policy\" content=\"" + (String(metaContent) + ("\">\n			</head>\n			<body>\n				<noscript>You need to enable JavaScript to run this app.</noscript>\n				<div id=\"root\"></div>\n        <script nonce=\"" + (String(nonce) + ("\" src=\"" + (String(scriptUri$1) + "\"></script>\n			</body>\n			</html>\n")))))));
}

function createPanel(state) {
  var fileName = Path.basename(state.editor.document.fileName, ".agda");
  var distPath = Path.join(state.context.extensionPath, "dist");
  var panel = Vscode.window.createWebviewPanel("panel", "Agda [" + (fileName + "]"), {
        preserveFocus: true,
        viewColumn: 3
      }, Vscode$AgdaModeVscode.WebviewAndWebviewPanelOptions.make(undefined, true, [Vscode.Uri.file(distPath)], undefined, undefined, undefined, /* () */0));
  panel.webview.html = html(distPath, "style.css", "bundled-view.js");
  panel.onDidDispose((function (param) {
          state.panel = undefined;
          return /* () */0;
        }));
  state.panel = panel;
  return /* () */0;
}

function moveToBottom(param) {
  return Vscode.commands.executeCommand("vscode.setEditorLayout", {
              orientation: 1,
              groups: [
                Curry._1(Vscode$AgdaModeVscode.Commands.Layout.sized, {
                      groups: [Vscode$AgdaModeVscode.Commands.Layout.simple],
                      size: 0.8
                    }),
                Curry._1(Vscode$AgdaModeVscode.Commands.Layout.sized, {
                      groups: [Vscode$AgdaModeVscode.Commands.Layout.simple],
                      size: 0.2
                    })
              ]
            });
}

function activate(state) {
  var match = state.panel;
  if (match !== undefined) {
    match.reveal(undefined, true);
    return /* () */0;
  } else {
    createPanel(state);
    moveToBottom(/* () */0);
    return /* () */0;
  }
}

function postMessage(panel, message) {
  panel.webview.postMessage(message);
  return /* () */0;
}

exports.html = html;
exports.createPanel = createPanel;
exports.moveToBottom = moveToBottom;
exports.activate = activate;
exports.postMessage = postMessage;
/* path Not a pure module */
