// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Core__Option = require("@rescript/core/lib/js/src/Core__Option.bs.js");
var Goal$AgdaModeVscode = require("../Goal.bs.js");
var Common$AgdaModeVscode = require("../View/Common.bs.js");
var Editor$AgdaModeVscode = require("../Editor.bs.js");

function updateIntervals(state) {
  var indices = state.goals.map(function (goal) {
        return goal.index;
      });
  var diffs = Goal$AgdaModeVscode.generateDiffs(state.document, indices);
  diffs.forEach(function (diff, i) {
        var goal = state.goals[i];
        if (goal !== undefined) {
          goal.interval = diff.modifiedInterval;
          return ;
        }
        
      });
}

function pointed(state) {
  updateIntervals(state);
  var cursor = Editor$AgdaModeVscode.Cursor.get(state.editor);
  var cursorOffset = state.document.offsetAt(cursor);
  var pointedGoals = state.goals.filter(function (goal) {
        return Common$AgdaModeVscode.Interval.contains(goal.interval, cursorOffset);
      });
  return Core__Option.map(pointedGoals[0], (function (goal) {
                return [
                        goal,
                        Goal$AgdaModeVscode.getContent(goal, state.document)
                      ];
              }));
}

function redecorate(state) {
  updateIntervals(state);
  state.goals.forEach(function (goal) {
        Goal$AgdaModeVscode.refreshDecoration(goal, state.editor);
      });
}

var Module = {
  pointed: pointed,
  redecorate: redecorate
};

exports.Module = Module;
exports.pointed = pointed;
exports.redecorate = redecorate;
/* Goal-AgdaModeVscode Not a pure module */
