// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Vscode = require("vscode");
var Nodepath = require("node:path");
var Util$AgdaModeVscode = require("../Util/Util.bs.js");

function make() {
  return {
          quickPick: Vscode.window.createQuickPick(),
          subscriptions: []
        };
}

function render(self) {
  self.quickPick.show();
}

function destroy(self) {
  self.quickPick.dispose();
  self.subscriptions.forEach(function (sub) {
        sub.dispose();
      });
}

var QP = {
  make: make,
  render: render,
  destroy: destroy
};

async function run(state, platformDeps) {
  var qp_quickPick = Vscode.window.createQuickPick();
  var qp_subscriptions = [];
  var qp = {
    quickPick: qp_quickPick,
    subscriptions: qp_subscriptions
  };
  qp_quickPick.placeholder = "Switch Version (v2)";
  var installedPaths = await platformDeps.getInstalledEndpointsAndPersistThem2(state.globalStorageUri);
  var pathItems = Array.from(installedPaths).map(function (path) {
        var filename = Nodepath.basename(path);
        return {
                description: "Unknown version (not probed yet)",
                detail: path,
                label: "$(file-binary) " + filename
              };
      });
  var items = pathItems.length > 0 ? [{
          kind: -1,
          label: "Installed"
        }].concat(pathItems) : [{
        description: "Try installing Agda or ALS first",
        detail: "No executable paths detected",
        label: "$(info) No installations found"
      }];
  qp_quickPick.items = items;
  qp_quickPick.show();
  Util$AgdaModeVscode.Disposable.add(qp_quickPick.onDidChangeSelection(function (_selectedItems) {
            destroy(qp);
          }), qp_subscriptions);
  return Util$AgdaModeVscode.Disposable.add(qp_quickPick.onDidHide(function () {
                  destroy(qp);
                }), qp_subscriptions);
}

exports.QP = QP;
exports.run = run;
/* vscode Not a pure module */
